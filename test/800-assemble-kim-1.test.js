'use strict'

const fs = require('fs')

const { strictEqual } = require('assert')
const { describe, it } = require('@popovmp/mocha-tiny')

const { Assembler } = require('../js')

describe('KIM-1', () => {
	it('Assembles a game', () => {
		const sourcePath =  (__dirname).endsWith('test') ? __dirname + '/kim-1-6530-002.asm' :  __dirname + '/test/kim-1-6530-002.asm'
		const sourceCode = fs.readFileSync( sourcePath, 'utf8')

		const assembler = new Assembler()
		const codePages = assembler.assemble(sourceCode)
		const actual    = Assembler.hexDump(codePages)

		strictEqual(actual,
`1C00: 85 F3 68 85 F1 68 85 EF 85 FA 68 85 F0 85 FB 84
1C10: F4 86 F5 BA 86 F2 20 8B 1E 4C 4F 1C 6C FA 17 6C
1C20: FE 17 A2 FF 9A 86 F2 20 8B 1E A9 FF 8D F3 17 A9
1C30: 01 2C 40 17 D0 19 30 F9 A9 FC 18 69 01 90 03 EE
1C40: F3 17 AC 40 17 10 F3 8D F2 17 A2 08 20 6D 1E 20
1C50: 8F 1E A9 01 2C 40 17 D0 1E 20 32 1E A2 0A 20 34
1C60: 1E 4C B2 1D A9 00 85 F8 85 F9 20 5D 1E C9 01 F0
1C70: 06 20 AD 1F 4C DE 1D 20 1A 1F D0 D3 A9 01 2C 40
1C80: 17 F0 CC 20 1A 1F F0 F4 20 1A 1F F0 EF 20 6B 1F
1C90: C9 15 10 BB C9 14 F0 44 C9 10 F0 2C C9 11 F0 2C
1CA0: C9 12 F0 2F C9 13 F0 31 0A 0A 0A 0A 85 FC A2 04
1CB0: A4 FF D0 0A B1 FA 06 FC 2A 91 FA 4C C3 1C 0A 26
1CC0: FA 26 FB CA D0 EA F0 08 A9 01 D0 02 A9 00 85 FF
1CD0: 4C 4F 1C 20 64 1F 4C 4F 1C 4C CB 1D A5 EF 85 FA
1CE0: A5 F0 85 FB 4C 4F 1C 20 5D 1E C9 3B D0 F9 A9 00
1CF0: 85 F7 85 F6 20 9E 1F AA 20 92 1F 20 9E 1F 85 FB
1D00: 20 92 1F 20 9E 1F 85 FA 20 92 1F 8A F0 0F 20 9E
1D10: 1F 91 FA 20 92 1F 20 64 1F CA D0 F2 E8 20 9E 1F
1D20: C5 F6 D0 17 20 9E 1F C5 F7 D0 13 8A D0 B9 A2 0C
1D30: A9 27 8D 42 17 20 34 1E 4C 4F 1C 20 9E 1F A2 11
1D40: D0 EE A9 00 85 F8 85 F9 A9 00 85 F6 85 F7 20 32
1D50: 1E A9 3B 20 A1 1E A5 FA CD F7 17 A5 FB ED F8 17
1D60: 90 1B A9 00 20 3E 1E 20 CD 1F 20 21 1E A5 F6 20
1D70: 21 1E A5 F7 20 3E 1E 20 92 1F 4C 64 1C A9 18 AA
1D80: 20 3E 1E 20 92 1F 20 21 1E A0 00 B1 FA 20 3E 1E
1D90: 20 92 1F 20 64 1F CA D0 F0 A5 F6 20 3E 1E A5 F7
1DA0: 20 3E 1E E6 F8 D0 02 E6 F9 4C 48 1D 20 CD 1F 20
1DB0: 32 1E 20 21 1E 20 A1 1E A0 00 B1 FA 20 3E 1E 20
1DC0: A1 1E 4C 64 1C 20 64 1F 4C AF 1D A6 F2 9A A5 FB
1DD0: 48 A5 FA 48 A5 F1 48 A6 F5 A4 F4 A5 F3 40 C9 20
1DE0: F0 CA C9 7F F0 1B C9 0D F0 DB C9 0A F0 1C C9 2E
1DF0: F0 26 C9 47 F0 D5 C9 51 F0 0A C9 4C F0 09 4C 6A
1E00: 1C 4C 4F 1C 4C 42 1D 4C E7 1C 38 A5 FA E9 01 85
1E10: FA B0 02 C6 FB 4C AF 1D A0 00 A5 F8 91 FA 4C C5
1E20: 1D A5 FB 20 3E 1E 20 92 1F A5 FA 20 3E 1E 20 92
1E30: 1F 60 A2 07 BD D6 1F 20 A1 1E CA 10 F7 60 85 FC
1E40: 4A 4A 4A 4A 20 4F 1E A5 FC 20 4F 1E A5 FC 60 29
1E50: 0F C9 0A 18 30 02 69 07 69 30 4C A1 1E 86 FD A2
1E60: 08 A9 01 2C 40 17 D0 22 30 F9 20 D5 1E 20 EC 1E
1E70: AD 40 17 29 80 46 FE 05 FE 85 FE 20 D5 1E CA D0
1E80: EF 20 EC 1E A6 FD A5 FE 2A 4A 60 A2 01 86 FF A2
1E90: 00 8E 41 17 A2 3F 8E 43 17 A2 07 8E 42 17 D8 78
1EA0: 60 85 FE 86 FD 20 D5 1E AD 42 17 29 FE 8D 42 17
1EB0: 20 D5 1E A2 08 AD 42 17 29 FE 46 FE 69 00 8D 42
1EC0: 17 20 D5 1E CA D0 EE AD 42 17 09 01 8D 42 17 20
1ED0: D5 1E A6 FD 60 AD F3 17 8D F4 17 AD F2 17 38 E9
1EE0: 01 B0 03 CE F4 17 AC F4 17 10 F3 60 AD F3 17 8D
1EF0: F4 17 AD F2 17 4A 4E F4 17 90 E3 09 80 B0 E0 A0
1F00: 03 A2 01 A9 FF 8E 42 17 E8 E8 2D 40 17 88 D0 F5
1F10: A0 07 8C 42 17 09 80 49 FF 60 A0 00 B1 FA 85 F9
1F20: A9 7F 8D 41 17 A2 09 A0 03 B9 F8 00 4A 4A 4A 4A
1F30: 20 49 1F B9 F8 00 29 0F 20 49 1F 88 D0 EB 8C 42
1F40: 17 A9 00 8D 41 17 4C FF 1E 84 FC A8 B9 E8 1F A0
1F50: 00 8C 40 17 8E 42 17 8D 40 17 A0 7F 88 D0 FD E8
1F60: E8 A4 FC 60 E6 FA D0 02 E6 FB 60 A2 21 A0 01 20
1F70: 03 1F D0 07 E0 27 D0 F5 A9 15 60 A0 FF 0A B0 03
1F80: C8 10 FA 8A 29 0F 4A AA 98 10 03 18 69 07 CA D0
1F90: FA 60 18 65 F7 85 F7 A5 F6 69 00 85 F6 60 20 5D
1FA0: 1E 20 AD 1F 4E 5D 1E 20 AD 1F A5 F8 60 C9 30 30
1FB0: 1B C9 47 10 17 C9 40 30 03 18 69 09 2A 2A 2A 2A
1FC0: A0 04 2A 26 F8 26 F9 88 D0 F8 A9 00 60 A5 F8 85
1FD0: FA A5 F9 85 FB 60 00 00 00 00 00 00 A0 AD 4D 49
1FE0: 4B 20 13 50 52 45 20 13 BF 86 DB CF E6 ED FD 87
1FF0: FF EF F7 FC B9 DE F9 F1  .  . 1C 1C 22 1C 1F 1C`
		)
	})


})
